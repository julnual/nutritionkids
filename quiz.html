<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>แบบประเมินความเสี่ยง</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f9f9f9;
      padding: 30px;
    }
    .quiz-container {
      max-width: 650px;
      margin: auto;
      background: #ffffff;
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h2 {
      color: #333;
      margin-bottom: 20px;
    }
    .question {
      margin-bottom: 20px;
    }
    .question p {
      font-weight: bold;
      margin-bottom: 8px;
    }
    .result {
      margin-top: 30px;
      padding: 20px;
      font-size: 18px;
      border-radius: 8px;
      display: none;
    }
    .low-risk {
      background: #e8f5e9;
      border-left: 6px solid #43a047;
      color: #2e7d32;
    }
    .medium-risk {
      background: #fff8e1;
      border-left: 6px solid #ffb300;
      color: #ef6c00;
    }
    .high-risk {
      background: #ffebee;
      border-left: 6px solid #e53935;
      color: #b71c1c;
    }
    .recommendation {
      margin-top: 10px;
      font-style: italic;
    }
    button {
      background-color: #00acc1;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background-color: #008b9a;
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h2 id="quizTitle">แบบประเมินความเสี่ยง</h2>
    <form id="quizForm">

      <!-- คำถาม -->
      <div class="question">
        <p>1. ผู้ป่วยมีภาวะทุพโภชนาการหรือไม่?</p>
        <label><input type="radio" name="q1" value="a"> ใช่ (0 คะแนน)</label><br>
        <label><input type="radio" name="q1" value="b"> ไม่ใช่ (1 คะแนน)</label>
      </div>

      <div class="question">
        <p>2. ผู้ป่วยมีโรคที่เสี่ยงต่อภาวะทุพโภชนาการ หรือคาดว่าจะมีการผ่าตัดใหญ่หรือไม่?</p>
        <label><input type="radio" name="q2" value="a"> ใช่ (2 คะแนน)</label><br>
        <label><input type="radio" name="q2" value="b"> ไม่ใช่ (0 คะแนน)</label>
      </div>

      <div class="question">
        <p>3. ผู้ป่วยมีอาการเกี่ยวกับระบบทางเดินอาหาร หรือรับประทานอาหารได้น้อยลง?</p>
        <label><input type="radio" name="q3" value="a"> ใช่ (1 คะแนน)</label><br>
        <label><input type="radio" name="q3" value="b"> ไม่ใช่ (0 คะแนน)</label>
      </div>

      <div class="question">
        <p>4. น้ำหนักลดลง หรือน้ำหนักไม่เพิ่มขึ้นในช่วง 2-3 เดือนที่ผ่านมา?</p>
        <label><input type="radio" name="q4" value="a"> ใช่ (0 คะแนน)</label><br>
        <label><input type="radio" name="q4" value="b"> ไม่ใช่ (1 คะแนน)</label>
      </div>

      <button type="submit">ส่งคำตอบ</button>
    </form>

    <div id="result" class="result"></div>
  </div>

  <script>
    // URL Params
    const urlParams = new URLSearchParams(window.location.search);
    const name = urlParams.get("name");
    const hn = urlParams.get("hn");

    // แสดงชื่อในหัวข้อ
    if (name) {
      document.getElementById("quizTitle").textContent += ` - คุณ ${name}`;
    }

    const scriptURL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec"; // ← แก้ URL นี้

    document.getElementById("quizForm").addEventListener("submit", function(event) {
      event.preventDefault();
      let score = 0;

      const answers = {
        q1: { correct: "b", weight: 1 },
        q2: { correct: "a", weight: 2 },
        q3: { correct: "a", weight: 1 },
        q4: { correct: "b", weight: 1 }
      };

      Object.keys(answers).forEach(q => {
        const selected = document.querySelector(`input[name="${q}"]:checked`);
        if (selected && selected.value === answers[q].correct) {
          score += answers[q].weight;
        }
      });

      // คำแนะนำตามคะแนน
      let recommendation = "";
      let riskClass = "";
      if (score === 0) {
        recommendation = "เสี่ยงต่ำ → ประเมินซ้ำอีก 1 สัปดาห์";
        riskClass = "low-risk";
      } else if (score >= 1 && score <= 3) {
        recommendation = "เสี่ยงปานกลาง → แจ้งแพทย์เจ้าของไข้";
        riskClass = "medium-risk";
      } else if (score >= 4) {
        recommendation = "เสี่ยงสูง → แจ้งแพทย์เจ้าของไข้";
        riskClass = "high-risk";
      }

      // แสดงผล
      const resultBox = document.getElementById("result");
      resultBox.className = `result ${riskClass}`;
      resultBox.innerHTML = `
        ได้คะแนน: <strong>${score} / 5</strong><br>
        <div class="recommendation">${recommendation}</div>
      `;
      resultBox.style.display = "block";

      // บันทึกลง Google Sheets
      fetch(scriptURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name: name || "ไม่ระบุ",
          hn: hn || "ไม่ระบุ",
          score: score,
          recommendation: recommendation
        })
      })
      .then(res => console.log("ส่งข้อมูลสำเร็จ"))
      .catch(err => console.error("เกิดข้อผิดพลาด:", err));
    });
  </script>
</body>
</html>
